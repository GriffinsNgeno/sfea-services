kind: pipeline
name: default
type: kubernetes
pull: if-not-exists
load: none

steps:
  - name: vendor
    image: bitnami/golang:1.20
    commands:
      - go mod vendor
    when:
      event:
        - push
      branch:
        - master

  - name: golangci-lint
    image: golangci/golangci-lint:latest-alpine
    depends_on:
      - vendor
    commands:
      - golangci-lint run
    when:
      event:
        - push
      branch:
        - master

  - name: gocritic
    image: jakewarren/gocritic:latest
    depends_on:
      - vendor
    commands:
      - gocritic check ./...
    when:
      event:
        - push
      branch:
        - master

  - name: test
    image: bitnami/golang:1.20
    depends_on:
      - golangci-lint
      - gocritic
    commands:
      - go test ./... -v
    when:
      event:
        - push
      branch:
        - master
