---
title: MongoDB
description: 
published: true
date: 2023-03-13T17:35:40.481Z
tags: 
editor: markdown
dateCreated: 2023-03-13T17:35:40.481Z
---

# Работа с MongoDB

Описание полей стандартно для актуализированного источника.

```json
[
  {
    "_id": {"$oid": "63f63e81d12041dee387479e"},
    "active": true,
    "count_success": 52367,
    "count_use": 52672,
    "created": {"$date": "2022-05-07T11:56:16.844Z"},
    "last_use": {"$date": "2023-02-26T17:40:12.956Z"},
    "next_use": {"$date": "2023-02-26T17:40:14.771Z"},
    "session": {
      "token": "a1i0w--XUIXm6-VV8GgodB5rAMR56l6zSNH_QMEcM_PijfE8evryin9QF6F5kbpd",
      "phone": "79663052122",
      "type": "bulk"
    }
  }
]
```

- `_id` - идентификатор в формате ObjectId
- `active` - boolean. Если active = false, сессия не используется никаким обработчиком.
- `count_success` - количество успешных использований сессий
- `created` - дата и время создания сессии
- `count_use` - общее количество использований сессий
- `last_use` - дата и время последнего использования сессии, обновляется чаще всего вместе с `count_use`
- `next_use` - дата и время после которого сессией можно дальше пользоваться. "Временная" блокировка сессии. 
- `session` - произвольное json поле, которое передается на вход классу обработчику
    - `token` - уникальный идентификатор авторизации сессии
    - `phone` - привязанный номер телефона к данной сессии, опциональное поле
    - `type` - search | bulk. Тип запросов, который нужн использовать при обработке данных.

В отличие от остальных источников в Truecaller есть 2 вида запросов - search и bulk со своими лимитами и временными блокировками. Для того, чтобы работа с БД была универсальной было принято решение каждую новую сессии добавлять x2 в БД, но с разным полем session.type (search, bulk).

Преимущества:
- Можно отдельно временно останавливать работу bulk запросов, не блокируя search запросы. 
- Задается кастомная сортировка при выборке сессии, сначала берутся bulk сессии, а потом search, чтобы не выходить за пределы. 