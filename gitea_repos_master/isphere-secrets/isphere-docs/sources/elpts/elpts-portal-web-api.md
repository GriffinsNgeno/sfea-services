---
title: Системы электронных паспортов
description: 
published: true
date: 2024-02-09T07:50:52.999Z
tags: 
editor: markdown
dateCreated: 2024-02-07T07:02:32.137Z
---

# Системы электронных паспортов

## elpts-portal-web-api
  
API сайта Системы Электронных Паспортов (https://portal.elpts.ru), осуществляет поиск информации по VIN и заводским номерам авто.

API приложения построено на `FastAPI`:
`/` - возвращает название приложения `elpts-portal-web-api`
`/docs` - swagger с онлайн документаций API

### Логика работы сайта
1. Загрузка главной страницы https://portal.elpts.ru.
2. Ввод VIN для поиска информации в поле input, отправка формы.
3. После отправки данных для поиска (формы), сайт, независимо от ого корректные данные или нет, возвращает капчу.
4. После отправки решения капчи, сайт возвращает: 
- ошибку решения капчи: `"Указаны неверные символы с картинки"` или `"Необходимо ввести проверочные символы"`;
- сообщение, если VIN введен некорректно или информация по VIN не найдена: `"Недостаточно сведений для поиска электронного паспорта.",  "Введите дополнительные параметры поиска."`;
- информацию по найденному авто, например: `'Вид электронного паспорта': 'Электронный паспорт транспортного средства', 'Статус электронного паспорта': 'действующий', 'Сведения об уплате утилизационного сбора': 'РФ уплачен', 'Сведения о выпуске (таможенное оформление)': 'Имеются', 'Таможенные ограничения': 'Отсутствуют', 'Ограничения (обременения) за исключением таможенных (РФ)': 'СВЕДЕНИЯ ОБ ОГРАНИЧЕНИЯХ ОТСУТСТВУЮТ', 'Сведения о последнем регистрационном действии': 'РФ - Постановка на регистрационный учет (10.10.2023)'`.
### Логика работы приложения
1.  Загрузка главной страницы, получение `id сессии`, `csrftoken`, `form link`, `input id`.
2. Отправка формы с данными поиска, данные формы подписываются `hmac`.
3. В ответ приходит `xml` с капчей.
4. Отправка капчи `сервису по решению капчи` и ожидание ответа (максимальное время ожидания задается константой  `CAPTCHA_TIMEOUT`)
5. Отправка результата решения капчи, данные формы подписываются `hmac`. В ответ приходит `xml` с результатами поиска или ошибками (см. выше). В сервис капчи отправляется результат решения капчи. 

### Настройки приложения
Файл `.env`:
- `MODE` - режим работы приложения;
- `PROXY_URL` - url адрес сервиса прокси;
- `NODE_PATH` - абсолютный путь к `node.js` (например `"/usr/bin/node"`);
- `CAPTCHA_SERVICE_URL` - url адрес сервиса по решению капчи;
- `CAPTCHA_PROVIDER` - провайдер сервиса по решению капчи;
- `SENTRY_URL` - url адрес Sentry.

Файл `src\config\app.py`
```python
class ConfigApp:  
    BASE_URL = "https://portal.elpts.ru"  
    HMAC_TIMEOUT = 1  
    CAPTCHA_SOURCE = "elpts-portal-web-api"  
    CAPTCHA_TIMEOUT = 30
```
где:
- `BASE_URL` - url адрес Системы Электронных Паспортов;
- `HMAC_TIMEOUT` - таймаут расчета hmac;
- `CAPTCHA_SOURCE` - названия источника для сервиса решения капчи;
- `CAPTCHA_TIMEOUT` - таймаут ожидания решения капчи.

Файл `logging.yaml` - настройка логера `uvicorn`.
