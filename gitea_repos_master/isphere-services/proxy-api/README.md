# proxy-api

## Зависимости
Все зависимости проекта описаны в файле Pipfile. Выполните установку зависимостей командой

```
pipenv install
```

## Загрузка данных прокси в пустую БД из json файла
В корне проекта расположен файл со скриптом загрузки данных из json файла о данных прокси.
Скрипт принимает путь к json файлу. Если файл расположен по пути /app/proxies.json, то для
выполнения скрипта нужно выполнить команду:

```
user@user:/home/user$ python3 load_proxies.py /app/proxies.json
```

Пример JSON файла:

```
[
    {
        "id": "12",
        "server": "51.15.15.230",
        "port": "3042",
        "login": "P1DR8cUjR3",
        "password": "B26NzpeOrh",
        "country": "us",
        "proxygroup": "6",
        "status": "0",
        "starttime": "2022-12-19 13:49:37",
        "lasttime": "2023-02-06 17:37:19",
        "successtime": "2023-02-06 17:36:19",
        "endtime":null
    }
]
```

## Запуск сервиса с файлом настроек логгирования
```
uvicorn main:app --log-config config/log_conf.yml
```

## Авторизация
В сервисе используется HTTP Basic Auth. При выполнении запроса, который требует учетных
данных, нужно настроить HTTP заголовок Authorization: __Authorization: Basic
<base64_username:password>__. Запрос с помощью curl можно выполнить следующим образом:
```
curl -X 'GET' 'http://localhost:8000/tags' -H 'accept: application/json' -u username:password
```


## Переменные окружения
Список ожидаемых переменных окружения, используемых сервисом, описан в файле .env.example.
По аналогии с ним необходимо настроить файл .env. Для этого нужно скопировать файл
.env.example под именем .env и настроить переменные окружения:

```commandline
cp .env.example .env
```

### Описание переменных окружения

#### MODE
По умолчанию: dev
Режим работы сервиса. Допустимые значения: dev, unittest, prod


#### POSTGRESQL_URL
По умолчанию: postgresql+asyncpg://user:password@localhost:5432
__Требует переопределения__. URL строка подключения к БД.


#### POSTGRESQL_DB
По умолчанию: proxy
Имя БД, с которой будет выполняться соединение.


#### POOL_SIZE
По умолчанию: 3
Пул соединений. Наибольшее количество подключений, которые будут постоянно храниться в
пуле.
